<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrestaPro | Sistema de Pr√©stamos</title>
    <link rel="stylesheet" href="dise√±o.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>

<div class="login-container" id="loginContainer">
    <div class="login-card">
        <div class="login-header">
            <h1 style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                <img src="assets/logo-verde.png" alt="Logo" style="height: 45px; width: auto;">
                PrestaPro </h1>
            <p>Bienvenido. Ingresa para continuar.</p>
        </div>
        <form id="loginForm">
            <div class="form-group">
                <label for="username">Usuario</label>
                <input type="text" id="username" placeholder="Tu nombre de usuario" required>
            </div>
            <div class="form-group">
                <label for="password">Contrase√±a</label>
                <input type="password" id="password" placeholder="Tu contrase√±a" required>
            </div>
            <div id="error-message" class="error-message"></div>
            <button type="submit" class="submit-button">Iniciar Sesi√≥n</button>
            <div class="login-footer">
                <a href="#" id="changePasswordLink">¬øOlvidaste tu contrase√±a?</a>
            </div>
        </form>
    </div>
</div>

<div id="appContainer" style="display: none;">
    <header class="main-header">
        <h1 id="appTitle">
            <img src="assets/logo-verde.png" alt="Logo PrestaPro" class="header-logo">
            PrestaPro
        </h1>

        <div class="header-user-controls">
            <span id="moraAlertIndicator" class="mora-indicator" style="display: none;">‚ö†Ô∏è</span>
            <span id="currentDateTime" class="datetime-display"></span>
            <span id="headerUserName" class="user-name-display">Admin</span>

            <div class="settings-dropdown">
                <button class="button button-secondary" id="settingsBtn">‚öôÔ∏è Configuraci√≥n</button>
                <div class="dropdown-content" id="settingsDropdown">
                    <div class="dropdown-section">
                        <h4>üé® Tema</h4>
                        <div class="theme-options">
                            <button class="theme-btn" onclick="setTheme('light')" title="Claro">‚òÄÔ∏è</button>
                            <button class="theme-btn" onclick="setTheme('dark')" title="Oscuro">zkr</button>
                            <button class="theme-btn" onclick="setTheme('system')" title="Sistema">üíª</button>
                        </div>
                    </div>
                    <div class="dropdown-section">
                        <h4>‚öôÔ∏è Opciones</h4>
                        <a href="#" id="menuChangePassword">Cambiar Contrase√±a</a>
                        <a href="#" id="menuReceiptConfig">Configurar Recibos</a>
                    </div>
                </div>

            </div>

            <button class="button button-secondary" id="logoutBtn">Cerrar Sesi√≥n</button>

        </div>
    </header>

    <div id="navigation-bar" style="display: none;">
        <button class="button button-primary" id="backToMenuBtn">‚¨Ö Retroceder</button>
    </div>

    <main class="container">

        <div id="module-menu" class="module-view active">
            <h2>Selecciona una Funci√≥n</h2>
            <div class="module-grid">
                <div class="module-card" data-target="module-prestamos">
                    <h3>üìù Pr√©stamos y Clientes</h3>
                    <p>Gestiona el historial, a√±ade nuevos pr√©stamos y revisa el progreso de pago.</p>
                    <button class="button button-primary button-full-width">Acceder al M√≥dulo</button>
                </div>
                <div class="module-card" data-target="module-pagos">
                    <h3>üí≥ Registrar Pagos</h3>
                    <p>Busca clientes por DNI, calcula mora y registra abonos r√°pidamente.</p>
                    <button class="button button-success button-full-width">Acceder al M√≥dulo</button>
                </div>
                <div class="module-card" data-target="module-caja">
                    <h3>üìä Cuadre de Caja</h3>
                    <p>Realiza el cuadre diario obligatorio y revisa el flujo de caja hist√≥rico.</p>
                    <button class="button button-warning button-full-width">Acceder al M√≥dulo</button>
                </div>
            </div>
        </div>

        <div id="module-prestamos" class="module-view">
            <div class="dashboard">
                <div class="stat-card">
                    <h3>üíµ Monto Total Prestado</h3>
                    <div class="value" id="totalLoaned">S/ 0.00</div>
                </div>
                <div class="stat-card">
                    <h3>üìã Pr√©stamos Activos</h3>
                    <div class="value" id="activeLoans">0</div>
                </div>
                <div class="stat-card">
                    <h3>üë• Clientes Totales</h3>
                    <div class="value" id="totalClients">0</div>
                </div>
                <div class="stat-card">
                    <h3>üí∞ Total Cobrado Hoy</h3>
                    <div class="value" id="collectedToday">S/ 0.00</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>üìö Historial de Pr√©stamos</h2>
                    <button class="button button-primary" id="addLoanBtn">+ Nuevo Pr√©stamo</button>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table id="historyTable" class="main-table">
                            <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>Monto</th>
                                <th>Progreso Pago</th>
                                <th>Estado</th>
                                <th>Mora</th>
                                <th>Acciones</th>
                            </tr>
                            </thead>
                            <tbody id="historyTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="module-pagos" class="module-view">
            <div class="card">
                <div class="card-header">
                    <h2>üí≥ Registro R√°pido de Pago</h2>
                </div>
                <div class="modal-body">

                    <div id="quick-payment-search-section" style="margin-bottom: 25px;">
                        <h3 class="step-header">1. Identificar Pr√©stamo por Documento</h3>
                        <div class="form-row">
                            <div class="form-group" style="max-width: 150px;">
                                <label for="search-doc-type-pago">Tipo Doc.</label>
                                <select id="search-doc-type-pago" required>
                                    <option value="DNI">DNI</option>
                                    <option value="RUC">RUC</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex-grow: 1;">
                                <label for="search-dni-pago">N¬∞ de Documento</label>
                                <input type="text" id="search-dni-pago" placeholder="Ingresa 8 u 11 d√≠gitos y presiona Enter" maxlength="11" inputmode="numeric">
                                <small id="search-dni-status" style="margin-top: 5px; display: block;"></small>
                            </div>
                        </div>
                    </div>

                    <div id="quick-payment-result-section" style="display: none;">
                        <h3 class="step-header">2. Seleccionar Pr√©stamo Activo</h3>
                        <div class="table-container" style="margin-top: 10px;">
                            <table class="main-table">
                                <thead><tr><th>Cliente</th><th>Monto Original</th><th>Deuda Pendiente</th><th>Acci√≥n</th></tr></thead>
                                <tbody id="quickPaymentTableBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <div id="quick-payment-summary-section" style="display: none;">
                        <h3 class="step-header">3. Configurar y Confirmar Pago</h3>

                        <div class="payment-checkout-grid">

                            <div class="checkout-actions">

                                <div id="mora-alert-summary" class="alert alert-warning" style="display:none; margin-bottom: 15px; font-size: 13px;">
                                    <span>‚ö†Ô∏è</span> <div>El pr√©stamo tiene cuotas vencidas. ¬°La mora se aplicar√° al total a cobrar!</div>
                                </div>

                                <h4>Seleccionar Cuotas y Monto</h4>

                                <div class="checkout-installments">
                                    <div class="form-group">
                                        <label>Tipo de Abono</label>
                                        <select id="payment_selection_type" class="payment-selection-type-select">
                                            <option value="single">Pagar 1 Cuota Pendiente</option>
                                            <option value="multiple">Pagar M√∫ltiples Cuotas</option>
                                        </select>
                                    </div>

                                    <div id="single-payment-info" class="payment-option-detail">
                                        <p>Cuota a vencer o m√°s antigua: <strong id="next_installment_date">N/A</strong></p>
                                        <p>Monto requerido: <strong id="next_installment_amount" style="color: var(--primary-color);">S/ 0.00</strong></p>
                                    </div>

                                    <div id="multiple-payment-info" class="payment-option-detail" style="display: none;">
                                        <div class="form-group">
                                            <label for="num_installments_to_pay">N¬∞ de Cuotas a Pagar (M√°x: <span id="max_installments_available">0</span>)</label>
                                            <input type="number" id="num_installments_to_pay" min="1" value="1" max="1" placeholder="Ej: 3">
                                        </div>
                                    </div>

                                    <div class="form-group" style="margin-top: 15px;">
                                        <label for="quick_payment_date">Fecha de Registro</label>
                                        <input type="text" id="quick_payment_date" required readonly>
                                    </div>

                                </div>

                                <div class="form-group" style="margin-top: 30px;">
                                    <h4>Seleccionar M√©todo de Pago</h4>
                                    <div class="form-row payment-methods-row" style="gap: 15px; grid-template-columns: 1fr 1fr 1fr;">
                                        <div class="checkbox-container payment-method-card" data-method="Efectivo" style="padding: 20px;">
                                            <input type="radio" name="quick_payment_method" id="q_method_cash" value="Efectivo" required>
                                            <label for="q_method_cash">üíµ Efectivo</label>
                                        </div>
                                        <div class="checkbox-container payment-method-card" data-method="Transferencia" style="padding: 20px;">
                                            <input type="radio" name="quick_payment_method" id="q_method_transfer" value="Transferencia" required>
                                            <label for="q_method_transfer">üí≥ Transferencia</label>
                                        </div>
                                        <div class="checkbox-container payment-method-card" data-method="Yape/Plin" style="padding: 20px;">
                                            <input type="radio" name="quick_payment_method" id="q_method_yape" value="Yape/Plin" required>
                                            <label for="q_method_yape">üì± Yape/Plin</label>
                                        </div>
                                    </div>
                                    <small style="margin-top: 10px;">*Solo los pagos en **Efectivo** se consideran para el cuadre de caja diario. Los pagos con tarjeta/transferencia usar√°n el flujo de Mercado Pago (link/QR).</small>
                                </div>

                            </div>

                            <div class="checkout-summary">
                                <h4>Resumen de la Transacci√≥n</h4>
                                <div class="summary-item"><span>Capital / Inter√©s</span><span id="summary-capital-interest">S/ 0.00</span></div>
                                <div class="summary-item"><span>Mora Aplicada</span><span id="summary-mora" class="danger">S/ 0.00</span></div>
                                <div class="summary-separator"></div>
                                <div class="summary-item summary-total"><span>MONTO A COBRAR</span><span id="summary-total" class="receipt-value">S/ 0.00</span></div>

                                <p style="margin-top: 20px; font-size: 13px; color: var(--text-color);">
                                    <span id="payment_description">Seleccione un tipo de abono y presione "Confirmar y Procesar Pago" una vez calculado el monto.</span>
                                </p>

                                <button class="submit-button" id="confirmQuickPaymentBtn" disabled style="margin-top: 30px;">‚úÖ Confirmar y Procesar Pago</button>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="module-caja" class="module-view">
            <div class="card">
                <div class="card-header">
                    <h2>üìä Control de Cuadre de Caja</h2>
                </div>
                <div class="modal-body">
                    <div class="cash-register-controls">
                        <div class="form-group">
                            <label for="cashRegisterDateFrom">Fecha del Cuadre</label>
                            <input type="date" id="cashRegisterDateFrom">
                        </div>
                        <div class="form-group" style="display: none;">
                            <label for="cashRegisterDateTo">Fecha Hasta</label>
                            <input type="date" id="cashRegisterDateTo" readonly>
                        </div>
                        <div class="form-group" style="display: flex; align-items: flex-end;">
                            <button class="button button-primary" id="filterCashRegisterBtn" style="width: 100%;">üîç Ver Cuadre</button>
                        </div>
                    </div>

                    <div id="cashRegisterSummary" class="cash-register-summary">
                        <p><strong>Total de Ingresos del D√≠a:</strong> S/ 0.00</p>
                        <p><strong>Ingreso Neto en Efectivo (Cuadre):</strong> S/ 0.00</p>
                        <p><strong>Ingreso por Transferencia/Yape:</strong> S/ 0.00</p>
                        <p><strong>Ingreso por Otros MP:</strong> S/ 0.00</p>
                    </div>

                    <div id="dailySquareSection">
                        <h3 style="margin-bottom: 15px; color: var(--secondary-color);">Cierre de Caja Diario (<span id="dailySquareDate">Fecha</span>)</h3>
                        <div id="squareStatusMessage" class="alert" style="display: none;"></div>
                        <div id="squareFormContainer">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="declaredAmount">Monto Total Contado (Efectivo)</label>
                                    <input type="number" id="declaredAmount" step="0.01" min="0" placeholder="Monto total contado en efectivo hoy" required>
                                </div>
                                <div class="form-group" style="display: flex; align-items: flex-end;">
                                    <button class="button button-success" id="saveDailySquareBtn" style="width: 100%;">‚úÖ Realizar Cierre de Caja</button>
                                </div>
                            </div>
                            <div id="squareValidationMessage" class="alert" style="display: none;"></div>
                        </div>
                    </div>

                    <h3 style="margin-top: 30px; margin-bottom: 15px; color: var(--secondary-color);">üí∞ Resumen de Movimientos del D√≠a</h3>
                    <div class="table-container">
                        <table id="cashRegisterTable" class="main-table">
                            <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>M√©todo</th>
                                <th>Capital/Inter√©s</th>
                                <th>Mora</th>
                                <th>Total Ingreso</th>
                            </tr>
                            </thead>
                            <tbody id="cashRegisterTableBody"></tbody>
                        </table>
                    </div>

                    <h3 style="margin-top: 30px; margin-bottom: 15px; color: var(--secondary-color);">üìú Historial de Cierres Oficiales</h3>
                    <div class="table-container">
                        <table id="closureHistoryTable" class="main-table">
                            <thead>
                            <tr>
                                <th>Fecha Cierre</th>
                                <th>Hora Cierre</th>
                                <th>Sistema (Efectivo)</th>
                                <th>Declarado (Efectivo)</th>
                                <th>Diferencia</th>
                                <th>Cerrado Por</th>
                            </tr>
                            </thead>
                            <tbody id="closureHistoryTableBody">
                            </tbody>
                        </table>
                    </div>

                </div>
                <div class="modal-footer">
                    <button class="button button-secondary" onclick="exportarHistorialCierresPDF()">üì• Exportar Historial</button>
                    <button class="button button-primary" onclick="imprimirHistorialCierres()">üñ®Ô∏è Imprimir Historial</button>
                </div>
            </div>
        </div>
    </main>
</div>

<div id="receiptConfigModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h2>‚öôÔ∏è Configuraci√≥n de Recibos</h2>
            <button class="close-button" id="closeReceiptConfigModalBtn">&times;</button>
        </div>
        <div class="modal-body">
            <form id="receiptConfigForm">
                <div class="form-group">
                    <label for="configRuc">R.U.C. Empresa</label>
                    <input type="text" id="configRuc" maxlength="11" required>
                </div>
                <div class="form-group">
                    <label for="configRazonSocial">Raz√≥n Social</label>
                    <input type="text" id="configRazonSocial" required>
                </div>
                <div class="form-group">
                    <label for="configDireccion">Direcci√≥n Completa</label>
                    <input type="text" id="configDireccion" required>
                </div>
                <div id="receipt-config-message" class="alert" style="display: none;"></div>
                <button type="submit" class="submit-button">üíæ Guardar Configuraci√≥n</button>
            </form>
        </div>
    </div>
</div>

<div id="loanModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üìù Registrar Nuevo Pr√©stamo</h2>
            <button class="close-button" id="closeModalBtn">&times;</button>
        </div>
        <div class="modal-body">
            <form id="loanForm"></form>
        </div>
    </div>
</div>

<div id="detailsModal" class="modal">
    <div class="modal-content large">
        <div class="printable">
            <div class="modal-header">
                <h2>üóìÔ∏è Cronograma y Detalles</h2>
                <button class="close-button" id="closeDetailsModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="scheduleSummary" class="summary-info"></div>
                <div id="moraInfo" class="alert alert-warning" style="display: none;"></div>
                <div id="declaracionJuradaSection" style="display: none; margin-bottom: 25px; border: 1px solid var(--border-color); padding: 20px; border-radius: 8px;"></div>

                <h3 style="margin-bottom: 15px; color: var(--secondary-color);">üìÖ Cronograma de Cuotas</h3>
                <div class="table-container">
                    <table id="scheduleTable" class="main-table">
                        <thead>
                        <tr>
                            <th>Cuota</th>
                            <th>Fecha de Vencimiento</th>
                            <th>Monto</th>
                        </tr>
                        </thead>
                        <tbody id="scheduleTableBody"></tbody>
                    </table>
                </div>

                <h3 style="margin-top: 30px; margin-bottom: 15px; color: var(--secondary-color);">üí≥ Historial de Pagos Realizados</h3>
                <div class="table-container">
                    <table id="paymentHistoryTable" class="main-table">
                        <thead>
                        <tr>
                            <th>N¬∞</th>
                            <th>Fecha de Pago</th>
                            <th>Monto Pagado</th>
                            <th>Mora Pagada</th>
                            <th>M√©todo</th>
                            <th>Comprobante</th>
                        </tr>
                        </thead>
                        <tbody id="paymentHistoryBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="button button-secondary" id="shareBtn">üîó Compartir</button>
            <button class="button button-primary" id="printScheduleBtn">üñ®Ô∏è Imprimir</button>
        </div>
    </div>
</div>

<div id="paymentModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h2 id="paymentModalTitle">üí≥ Registrar Pago</h2>
            <button class="close-button" id="closePaymentModalBtn">&times;</button>
        </div>
        <div class="modal-body">
            <div id="paymentMoraInfo" class="alert alert-warning" style="display: none;"></div>

            <h3 style="margin-bottom: 10px;">1. Seleccionar M√©todo de Pago</h3>
            <div class="form-group">
                <div class="form-row" style="gap: 10px; grid-template-columns: 1fr 1fr 1fr;">
                    <div class="checkbox-container payment-method-card" data-method="Efectivo" style="flex: 1; border: 1px solid var(--border-color); cursor: pointer; padding: 10px; text-align: center;">
                        <input type="radio" name="payment_method" id="method_cash" value="Efectivo" required>
                        <label for="method_cash" style="color: var(--secondary-color); font-weight: 600;">üíµ Efectivo</label>
                    </div>
                    <div class="checkbox-container payment-method-card" data-method="Transferencia" style="flex: 1; border: 1px solid var(--border-color); cursor: pointer; padding: 10px; text-align: center;">
                        <input type="radio" name="payment_method" id="method_transfer" value="Transferencia" required>
                        <label for="method_transfer" style="color: var(--secondary-color); font-weight: 600;">üí≥ Transferencia</label>
                    </div>
                    <div class="checkbox-container payment-method-card" data-method="Yape/Plin" style="flex: 1; border: 1px solid var(--border-color); cursor: pointer; padding: 10px; text-align: center;">
                        <input type="radio" name="payment_method" id="method_yape" value="Yape/Plin" required>
                        <label for="method_yape" style="color: var(--secondary-color); font-weight: 600;">üì± Yape/Plin</label>
                    </div>
                </div>
                <small style="margin-top: 10px;">*Los pagos con **Transferencia** o **Yape/Plin** se procesan mediante un link/QR de Mercado Pago.</small>
            </div>

            <h3 style="margin-top: 20px; margin-bottom: 10px;">2. Montos a Pagar</h3>
            <form id="paymentForm">
                <input type="hidden" id="paymentLoanId">

                <div class="form-group">
                    <label for="payment_amount">Monto a Pagar (Capital/Inter√©s S/)</label>
                    <input type="number" id="payment_amount" required step="0.01" min="0.01">
                    <small id="payment_amount_hint"></small>
                </div>

                <div class="form-group">
                    <label for="mora_amount">Mora a Pagar (S/)</label>
                    <input type="number" id="mora_amount" step="0.01" min="0" value="0">
                    <small>Se llena autom√°ticamente si hay mora pendiente.</small>
                </div>

                <div class="form-group">
                    <label for="payment_date">Fecha de Pago</label>
                    <input type="date" id="payment_date" required>
                </div>

                <button type="submit" class="submit-button">Confirmar Pago</button>
            </form>
        </div>
    </div>
</div>

<div id="receiptModal" class="modal">
    <div class="modal-content" style="max-width: 650px;">
        <div class="modal-header">
            <h2>üßæ Comprobante de Pago</h2>
            <button class="close-button" id="closeReceiptModalBtn">&times;</button>
        </div>
        <div class="modal-body">
            <div id="receiptContent" class="receipt-container"></div>
        </div>
        <div class="modal-footer">
            <button class="button button-secondary" id="shareReceiptBtn">üîó Compartir Comprobante</button>
            <button class="button button-primary" id="printReceiptBtn">üñ®Ô∏è Imprimir</button>
        </div>
    </div>
</div>

<div id="deleteConfirmationModal" class="modal">
    <div class="modal-content" style="max-width: 480px;">
        <div class="modal-header">
            <h2 id="deleteModalTitle">‚ö†Ô∏è Confirmar Eliminaci√≥n</h2>
            <button class="close-button" id="closeDeleteModalBtn">&times;</button>
        </div>
        <div class="modal-body">
            <form id="deleteConfirmationForm">
                <input type="hidden" id="deleteLoanId">
                <div class="alert alert-danger">
                    <span>‚ö†Ô∏è</span>
                    <div>
                        <p style="margin: 0;"><strong>Esta acci√≥n es permanente y no se puede deshacer.</strong></p>
                        <p style="margin: 8px 0 0 0;">Se eliminar√° el pr√©stamo y todo su historial de pagos.</p>
                    </div>
                </div>
                <p>Para confirmar, por favor escribe la palabra <strong style="color: var(--danger-color);">ELIMINAR</strong> en el campo de abajo.</p>
                <div class="form-group">
                    <label for="delete_confirmation_text">Confirmaci√≥n</label>
                    <input type="text" id="delete_confirmation_text" required autocomplete="off" placeholder="ELIMINAR">
                    <small id="delete-error-message" style="color: var(--danger-color); display: none;">El texto no coincide.</small>
                </div>
                <button type="submit" class="submit-button-danger">Eliminar Pr√©stamo Permanentemente</button>
            </form>
        </div>
    </div>
</div>

<div id="changePasswordModal" class="modal">
    <div class="modal-content" style="max-width: 480px;">
        <div class="modal-header">
            <h2>üîê Cambiar Contrase√±a</h2>
            <button class="close-button" id="closeChangePasswordModalBtn">&times;</button>
        </div>
        <div class="modal-body">
            <form id="changePasswordForm">
                <p style="background-color: var(--primary-light); padding: 12px; border-radius: 8px; font-size: 14px; margin-bottom: 20px; color: var(--text-color);">
                    ‚ÑπÔ∏è Esto es una simulaci√≥n. La contrase√±a se reiniciar√° al actualizar la p√°gina.
                </p>
                <div class="form-group">
                    <label for="current_password">Contrase√±a Actual</label>
                    <input type="password" id="current_password" required placeholder="Ingresa tu contrase√±a actual">
                </div>
                <div class="form-group">
                    <label for="new_password">Nueva Contrase√±a</label>
                    <input type="password" id="new_password" required placeholder="M√≠nimo 6 caracteres">
                </div>
                <div class="form-group">
                    <label for="confirm_new_password">Confirmar Nueva Contrase√±a</label>
                    <input type="password" id="confirm_new_password" required placeholder="Repite la nueva contrase√±a">
                </div>
                <div id="change-password-error" class="error-message"></div>
                <button type="submit" class="submit-button">Actualizar Contrase√±a</button>
            </form>
        </div>
    </div>
</div>

<div id="checkoutLinkModal" class="modal">
    <div class="modal-content" style="max-width: 550px;">
        <div class="modal-header">
            <h2 id="checkoutLinkTitle">üîó Enlace de Pago Generado</h2>
            <button class="close-button" id="closeCheckoutLinkModalBtn">&times;</button>
        </div>
        <div class="modal-body">
            <div class="alert alert-success">
                <span>‚úÖ</span>
                <div>
                    <p style="margin: 0;"><strong>Instrucciones:</strong></p>
                    <p style="margin: 5px 0 0 0;">Copia el enlace de abajo y comp√°rtelo con el cliente por WhatsApp, correo o el medio de tu preferencia. El pago se registrar√° autom√°ticamente al ser completado.</p>
                </div>
            </div>

            <h3 style="margin-top: 10px; margin-bottom: 5px;">Monto Total: <span id="checkoutLinkAmount" style="color: var(--success-color);"></span></h3>
            <p style="font-size: 14px; margin-bottom: 15px;">M√©todo: <strong id="checkoutLinkMethod"></strong></p>

            <div class="form-group">
                <label for="mpLinkOutput">Enlace de Pago (Mercado Pago)</label>
                <input type="text" id="mpLinkOutput" readonly style="cursor: text; font-size: 13px; background-color: var(--input-bg);">
            </div>

            <div class="modal-footer" style="justify-content: space-between; padding: 0;">
                <button class="button button-secondary" id="shareMpLinkBtn" style="width: 48%;">üîó Compartir Enlace</button>
                <button class="button button-primary" id="copyLinkBtn" style="width: 48%;">üìã Copiar Enlace</button>
            </div>
        </div>
    </div>
</div>

<div id="successAnimation" class="animation-container" style="display: none;">
    <div class="animation-content">
        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
            <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
            <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
        </svg>
        <p id="successText">¬°Pr√©stamo Registrado!</p>
    </div>
</div>


<div id="shareOptionsModal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <h2>üì§ Compartir Documento</h2>
            <button class="close-button" id="closeShareOptionsModalBtn">&times;</button>
        </div>
        <div class="modal-body">
            <p style="font-size: 13px; color: var(--secondary-color); margin-bottom: 20px;">
                Elige un medio para enviar el documento. <br>
                <small style="color: #9CA3AF;">(Para Gmail/WhatsApp Web, el PDF se descargar√° para que lo adjuntes).</small>
            </p>

            <div class="share-grid">
                <button class="share-option-btn gmail" onclick="handleSmartShare('gmail')">
                    <span class="icon">üìß</span>
                    <span class="text">Gmail</span>
                </button>

                <button class="share-option-btn whatsapp" onclick="handleSmartShare('whatsapp')">
                    <span class="icon">üíö</span>
                    <span class="text">WhatsApp</span>
                </button>

                <button class="share-option-btn copy" onclick="handleSmartShare('copy')">
                    <span class="icon">üìã</span>
                    <span class="text">Copiar Texto</span>
                </button>

                <button class="share-option-btn native" onclick="handleSmartShare('native')">
                    <span class="icon">üíª</span>
                    <span class="text">Otros / Windows</span>
                </button>
            </div>
        </div>
    </div>
</div>

<script src="logica.js"></script>
</body>
</html>